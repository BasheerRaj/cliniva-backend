### M2 - Onboarding: Company Plan Flow
### Use Case: UC-c5e6f4d - Setup Company Plan
### Description: Complete onboarding flow for Company Plan (Organization → Complex → Clinic)

@baseUrl = http://localhost:3001/api/v1

@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OTg5Y2MzNTBmYTZjNmU3NDFmYTM1MDgiLCJlbWFpbCI6ImNvbXBhbnkub3duZXIxQGNsaW5pdmEuY29tIiwicm9sZSI6Im93bmVyIiwiaWF0IjoxNzcwNjM4Mzg5LCJleHAiOjE3NzA3MjQ3ODl9.Sy8WLYB_dqPBgMalGYygZ8PeT-1g0Z_jk9ny1WhooxI
@userId = 6989cc350fa6c6e741fa3508

@companyPlanId = 6989c2e2ca3d9aa044ffc4bc

@subscriptionId = 6989cc5d0fa6c6e741fa3511

@organizationId = 6989d6f47cbd22766fa4bd87

@complexId = 6989d92c3afb0243797a37a0
@complexId1 = 6989d9903afb0243797a37b0
@complexId2 = 6989d9c23afb0243797a37c2
@complexId3 = 6989de1d3afb0243797a37d7

@cardiologyDeptId = 6989c2e2ca3d9aa044ffc4d4
@pediatricsDeptId = 6989c2e2ca3d9aa044ffc519
@generalMedicineDeptId = 6989c2e2ca3d9aa044ffc500

@cardiologyClinicId = 6989e31ba2732987ac23cb47
@pediatricsClinicId = 6989e341a2732987ac23cb54



###############################################################################
# 1. User Registration
###############################################################################

### 1.1 Register new user (owner)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "company.owner1@cliniva.com",
  "password": "CompanyOwner@123",
  "confirmPassword": "CompanyOwner@123",
  "firstName": "Mohammed",
  "lastName": "Al-Saud",
  "phone": "+966501234567",
  "dateOfBirth": "1985-03-20",
  "gender": "male",
  "nationality": "Saudi Arabia",
  "role": "owner"
}

# Expected Response:
# - 201 Created
# - User created successfully
# - Email verification sent (if enabled)

### 1.2 Login with new account
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "company.owner@cliniva.com",
  "password": "CompanyOwner@123"
}


###############################################################################
# 2. Get Available Subscription Plans
###############################################################################

### 2.1 Get all subscription plans
GET {{baseUrl}}/subscriptions/plans
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - List of available plans (Company, Complex, Clinic)
# - Plan details with features and pricing


###############################################################################
# 3. Select Company Plan
###############################################################################

### 3.1 Create subscription with Company Plan
POST {{baseUrl}}/subscriptions
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "subscriptionPlanId": "{{companyPlanId}}",
  "userId": "{{userId}}",
  "paymentMethod": "credit_card",
  "billingCycle": "monthly"
}

# Expected Response:
# - 201 Created
# - Subscription created
# - Payment pending or completed

###############################################################################
# 4. Step 1: Create Organization (Company)
###############################################################################

### 4.1 Create organization with complete information
POST {{baseUrl}}/organizations
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Al-Shifa Medical Group",
  "legalName": "Al-Shifa Medical Services Company",
  "tradeName": "Al-Shifa Healthcare",
  "logoUrl": "https://example.com/logos/alshifa.png",
  "website": "https://alshifa-medical.com",
  "yearEstablished": 2010,
  "overview": "Leading healthcare provider in Saudi Arabia",
  "vision": "To be the most trusted healthcare provider in the region",
  "goals": "Provide world-class medical services to all communities",
  "ceoName": "Dr. Abdullah Al-Rashid",
  "phoneNumbers": [
    {
      "type": "primary",
      "number": "+966112345678",
      "label": "Main Office"
    },
    {
      "type": "secondary",
      "number": "+966112345679",
      "label": "Support Line"
    }
  ],
  "email": "info@alshifa-medical.com",
  "address": {
    "street": "King Fahd Road",
    "city": "Riyadh",
    "state": "Riyadh Region",
    "country": "Saudi Arabia",
    "postalCode": "12345",
    "googleLocation": "24.7136,46.6753"
  },
  "emergencyContact": {
    "name": "Emergency Department",
    "phone": "+966112345680",
    "email": "emergency@alshifa-medical.com"
  },
  "socialMediaLinks": {
    "facebook": "https://facebook.com/alshifa",
    "twitter": "https://twitter.com/alshifa",
    "instagram": "https://instagram.com/alshifa",
    "linkedin": "https://linkedin.com/company/alshifa"
  },
  "vatNumber": "300123456700003",
  "crNumber": "1010123456",
  "termsConditionsUrl": "https://alshifa-medical.com/terms",
  "privacyPolicyUrl": "https://alshifa-medical.com/privacy",
  "subscriptionId": "{{subscriptionId}}",
  "ownerId": "{{userId}}"
}

# Expected Response:
# - 201 Created
# - Organization created successfully
# - Returns organization ID


###############################################################################
# 5. Step 2: Create Medical Complex
###############################################################################

### 5.1 Create first medical complex
POST {{baseUrl}}/complexes
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Al-Rahma Family Healthcare Center - Medina",
  "managerName": "Dr. Ayman Al-Mutairi",
  "logoUrl": "https://example.com/logos/alrahma-medina.png",
  "website": "https://alrahma-healthcare.com/medina",
  "yearEstablished": 2012,
  "mission": "Provide compassionate, family-oriented healthcare services for all age groups",
  "vision": "To be the most trusted family healthcare center in Medina",
  "overview": "A comprehensive family healthcare center offering primary care and preventive services",
  "goals": "Support 20,000+ patient visits annually with a focus on preventive care",
  "ceoName": "Dr. Hassan Al-Zaid",
  "phoneNumbers": [
    {
      "type": "primary",
      "number": "+966148700221",
      "label": "Main Reception"
    },
    {
      "type": "secondary",
      "number": "+966148700222",
      "label": "Appointments Desk"
    }
  ],
  "email": "support@alrahma-healthcare.com",
  "address": {
    "street": "Quba Road",
    "city": "Medina",
    "state": "Al Madinah Region",
    "country": "Saudi Arabia",
    "postalCode": "42316",
    "googleLocation": "24.5247,39.5692"
  },
  "emergencyContact": {
    "name": "24/7 Emergency Unit",
    "phone": "+966148700223",
    "email": "emergency@alrahma-healthcare.com"
  },
  "socialMediaLinks": {
    "facebook": "https://facebook.com/alrahma.medina",
    "twitter": "https://twitter.com/alrahma_md",
    "instagram": "https://instagram.com/alrahma.medina"
  },
  "vatNumber": "300321654800001",
  "crNumber": "4650123987",
  "organizationId": "{{organizationId}}",
  "subscriptionId": "{{subscriptionId}}",
  "ownerId": "{{userId}}",
  "departments": [
    "6989c2e2ca3d9aa044ffc4d4",
    "6989c2e2ca3d9aa044ffc4e1"
  ]
}



# Expected Response:
# - 201 Created
# - Complex created successfully
# - Returns complex ID



###############################################################################
# 6. Step 3: Create Departments
###############################################################################
### 6.0.1 Get departments

GET {{baseUrl}}/departments
Authorization: Bearer {{accessToken}}
Content-Type: application/json


### 6.1 Create Cardiology Department
POST {{baseUrl}}/departments
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Cardiology",
  "description": "Heart and cardiovascular care",
  "complexId": "{{complexId}}"
}


### 6.2 Create Pediatrics Department
POST {{baseUrl}}/departments
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Pediatrics",
  "description": "Children's healthcare",
  "complexId": "{{complexId}}"
}


### 6.3 Create General Medicine Department
POST {{baseUrl}}/departments
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "General Medicine",
  "description": "General medical consultations",
  "complexId": "{{complexId}}"
}


###############################################################################
# 7. Step 4: Create Clinics
###############################################################################

### 7.1 Create Cardiology Clinic
POST {{baseUrl}}/clinics
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Cardiology Clinic",
  "headDoctorName": "Dr. Fahad Al-Mutairi",
  "specialization": "Cardiology",
  "licenseNumber": "CARD-2024-001",
  "pin": "1234",
  "logoUrl": "https://example.com/logos/cardiology-clinic.png",
  "website": "https://alshifa-medical.com/cardiology",
  "yearEstablished": 2015,
  "mission": "Excellence in cardiac care",
  "phoneNumbers": [
    {
      "type": "primary",
      "number": "+966112345683",
      "label": "Cardiology Clinic"
    }
  ],
  "email": "cardiology@alshifa-medical.com",
  "address": {
    "street": "Olaya Street, Building A",
    "city": "Riyadh",
    "state": "Riyadh Region",
    "country": "Saudi Arabia",
    "postalCode": "12345"
  },
  "vatNumber": "300123456700005",
  "crNumber": "1010123458",
  "complexId": "{{complexId}}",
  "complexDepartmentId": "{{cardiologyDeptId}}",
  "subscriptionId": "{{subscriptionId}}",
  "ownerId": "{{userId}}",
  "maxStaff": 10,
  "maxDoctors": 5,
  "maxPatients": 100,
  "sessionDuration": 30
}


### 7.2 Create Pediatrics Clinic
POST {{baseUrl}}/clinics
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "name": "Pediatrics Clinic",
  "headDoctorName": "Dr. Sara Al-Zahrani",
  "specialization": "Pediatrics",
  "licenseNumber": "PED-2024-001",
  "pin": "5678",
  "logoUrl": "https://example.com/logos/pediatrics-clinic.png",
  "phoneNumbers": [
    {
      "type": "primary",
      "number": "+966112345684",
      "label": "Pediatrics Clinic"
    }
  ],
  "email": "pediatrics@alshifa-medical.com",
  "address": {
    "street": "Olaya Street, Building B",
    "city": "Riyadh",
    "state": "Riyadh Region",
    "country": "Saudi Arabia",
    "postalCode": "12345"
  },
  "vatNumber": "300123456700006",
  "crNumber": "1010123459",
  "complexId": "{{complexId}}",
  "complexDepartmentId": "{{pediatricsDeptId}}",
  "subscriptionId": "{{subscriptionId}}",
  "ownerId": "{{userId}}",
  "maxStaff": 8,
  "maxDoctors": 4,
  "maxPatients": 80,
  "sessionDuration": 20
}


###############################################################################
# 8. Verify Complete Setup
###############################################################################

### 8.1 Get organization with all relationships
GET {{baseUrl}}/organizations/{{organizationId}}
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - Organization details
# - Includes complexes, departments, clinics

### 8.2 Get complex with clinics
GET {{baseUrl}}/complexes/{{complexId}}
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - Complex details
# - List of departments and clinics

### 8.3 Get user profile (should show onboarding complete)
GET {{baseUrl}}/auth/profile
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - User profile
# - onboardingComplete: true
# - setupComplete: true

###############################################################################
# 9. Update User Onboarding Status
###############################################################################

### 9.1 Mark onboarding as complete
PUT {{baseUrl}}/users/{{userId}}
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "onboardingComplete": true,
  "setupComplete": true
}

# Expected Response:
# - 200 OK
# - User updated successfully
# - Can now access full system

###############################################################################
# 10. Access Dashboard
###############################################################################

### 10.1 Get dashboard data
# GET {{baseUrl}}/dashboard
# Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - Dashboard widgets and statistics
# - Organization overview
# - Complex and clinic summaries
