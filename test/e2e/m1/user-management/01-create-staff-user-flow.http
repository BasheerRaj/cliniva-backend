### M1 - User Management: Create Staff User Flow
### Use Case: UC-7a6b5c4 - Create Staff User
### Description: Complete flow to create a staff user with all required information

@baseUrl = http://localhost:3001/api/v1
@adminEmail = company.owner1@cliniva.com
@adminPassword = CompanyOwner@123
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OTg5Y2MzNTBmYTZjNmU3NDFmYTM1MDgiLCJlbWFpbCI6ImNvbXBhbnkub3duZXIxQGNsaW5pdmEuY29tIiwicm9sZSI6ImFkbWluIiwiaWF0IjoxNzcwNzI1NTEwLCJleHAiOjE3NzA4MTE5MTB9.c8y-U0UR1H67Jomc47kIuCLmomVw2pXdXi5GagJjQhY
@subscriptionId = 6989c883e85c6be91e02006e
@complexId = 6989d92c3afb0243797a37a0
@clinicId = 6989e341a2732987ac23cb54
@staffUserId = <copy_user_id_from_response>
@employeeId = 698b29e8eb24950ca41d3f31
@temporaryPassword = <copy_temporary_password_from_response>
@staffAccessToken = <copy_access_token_from_response>

###############################################################################
# 1. Admin Login
###############################################################################

### 1.1 Login as admin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}



###############################################################################
# 2. Get Available Complexes and Clinics
###############################################################################

### 2.1 Get complexes for dropdown
GET {{baseUrl}}/complexes?subscriptionId={{subscriptionId}}
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - List of complexes for selection

### 2.2 Get clinics by complex
GET {{baseUrl}}/clinics?complexId={{complexId}}
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - List of clinics within the selected complex

###############################################################################
# 3. Create Staff User - Success Case
###############################################################################

### 3.1 Create staff user with complete information
POST {{baseUrl}}/employees
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "email": "staff.member1@cliniva.com",
  "password": "TempPassword@123",
  "firstName": "Ahmed",
  "lastName": "Hassan",
  "phone": "+966501234517",
  "dateOfBirth": "1990-05-15",
  "gender": "male",
  "nationality": "Saudi Arabia",
  "role": "staff",
  "complexId": "{{complexId}}",
  "clinicId": "{{clinicId}}",
  "jobTitle": "Receptionist",
  "dateOfHiring": "2024-01-15",
  "salary": 5000,
  "maritalStatus": "single",
  "numberOfChildren": 0,
  "bankAccount": "SA1234567890123456789012",
  "socialSecurityNumber": "1234567890",
  "taxId": "TAX123456"
}

# Expected Response:
# - 201 Created
# - Returns user object with employee profile
# - Auto-generated employee number (e.g., EMP2024001)
# Note: Working hours should be managed separately via shifts endpoint



###############################################################################
# 4. Verify Staff User Created
###############################################################################

### 4.1 Get staff user details
GET {{baseUrl}}/employees/{{employeeId}}
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - Complete user and employee profile
# - Working hours included

### 4.2 Get user by ID
GET {{baseUrl}}/users/{{staffUserId}}
Authorization: Bearer {{accessToken}}

# Expected Response:
# - 200 OK
# - User details with relationships

###############################################################################
# 5. Staff User First Login
###############################################################################

### 5.1 Staff logs in with temporary password
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "staff.member1@cliniva.com",
  "password": "TempPassword@123"
}

# Expected Response:
# - 200 OK
# - Login successful
# - Should prompt for password change (future feature)


### 5.2 Staff changes password
POST {{baseUrl}}/auth/change-password
Authorization: Bearer {{staffAccessToken}}
Content-Type: application/json

{
  "currentPassword": "{{temporaryPassword}}",
  "newPassword": "StaffPassword@123",
  "confirmPassword": "StaffPassword@123"
}

# Expected Response:
# - 200 OK
# - Password changed successfully

###############################################################################
# 6. Create Staff User - Validation Errors
###############################################################################

### 6.1 Create user with missing required fields
POST {{baseUrl}}/employees
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "email": "incomplete@cliniva.com",
  "firstName": "Test"
}

# Expected Response:
# - 400 Bad Request
# - Validation errors for: password, lastName, phone, role, gender, dateOfBirth, jobTitle, dateOfHiring

### 6.2 Create user with invalid email format
POST {{baseUrl}}/employees
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "email": "not-an-email",
  "password": "ValidPass@123",
  "firstName": "Test",
  "lastName": "User",
  "phone": "+966501234567",
  "dateOfBirth": "1990-01-01",
  "gender": "male",
  "nationality": "Saudi Arabia",
  "role": "staff",
  "clinicId": "{{clinicId}}",
  "jobTitle": "Staff Member",
  "dateOfHiring": "2024-01-01"
}

# Expected Response:
# - 400 Bad Request
# - Error: Invalid email format

### 6.3 Create user with duplicate email
POST {{baseUrl}}/employees
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "email": "staff.member@cliniva.com",
  "password": "ValidPass@123",
  "firstName": "Duplicate",
  "lastName": "User",
  "phone": "+966501234568",
  "dateOfBirth": "1990-01-01",
  "gender": "male",
  "nationality": "Saudi Arabia",
  "role": "staff",
  "clinicId": "{{clinicId}}",
  "jobTitle": "Staff Member",
  "dateOfHiring": "2024-01-01"
}

# Expected Response:
# - 400 Bad Request
# - Error code: USER_001
# - Message: User already exists

### 6.4 Create user with future date of birth
POST {{baseUrl}}/employees
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "email": "future@cliniva.com",
  "password": "ValidPass@123",
  "firstName": "Future",
  "lastName": "User",
  "phone": "+966501234569",
  "dateOfBirth": "2030-01-01",
  "gender": "male",
  "nationality": "Saudi Arabia",
  "role": "staff",
  "clinicId": "{{clinicId}}",
  "jobTitle": "Staff Member",
  "dateOfHiring": "2024-01-01"
}

# Expected Response:
# - 400 Bad Request
# - Error: Date of birth cannot be in the future

### 6.5 Create user with invalid phone format
POST {{baseUrl}}/employees
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "email": "invalidphone@cliniva.com",
  "password": "ValidPass@123",
  "firstName": "Invalid",
  "lastName": "Phone",
  "phone": "123",
  "dateOfBirth": "1990-01-01",
  "gender": "male",
  "nationality": "Saudi Arabia",
  "role": "staff",
  "clinicId": "{{clinicId}}",
  "jobTitle": "Staff Member",
  "dateOfHiring": "2024-01-01"
}

# Expected Response:
# - 400 Bad Request
# - Error: Phone must be at least 10 characters

